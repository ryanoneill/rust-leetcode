/// The *count-and-say* sequence is a sequence of digit strings defined by the recursive formula:
///
/// * `countAndSay(1) = "1"`
/// * `countAndSay(n) is the run-length encoding of countAndSay(n-1)`.
///
/// Run-length encoding (RLE) is a string compression method that works by replacing consecutive
/// identical characters (repeated 2 or more times) with the concatenation of the character and the
/// number marking the count of the characters (length of the run). For example, to compress the
/// string `"3322251"` we replace the `"33"` with `"23"`, replace the `"222"` with `"32"`, replace
/// `"5"` with `"15"` and replace `"1"` with `"11"`. Thus the compressed string becomes
/// `"23321511"`.
///
/// Given a positive integer `n`, return the `nth` element of the *count-and-say* sequence.
struct Solution;

impl Solution {

    fn rle(s: String) -> String {
        let mut letters = Vec::new();
        let mut last = ' ';
        let mut count = 0;

        for c in s.chars() {
            if count == 0 {
                count = 1;
                last = c;
            } else if c == last {
                count += 1;
            } else {
                for c in count.to_string().chars() {
                    letters.push(c);
                }
                letters.push(last);

                count = 1;
                last = c;
            }
        }
        for c in count.to_string().chars() {
            letters.push(c);
        }
        letters.push(last);

        letters.into_iter().collect()
    }

    pub fn count_and_say(n: i32) -> String {
        let n = n as usize;
        let mut result = "1".to_string();

        for _ in 2..=n {
            result = Self::rle(result);
        }

        result
    }

}

#[cfg(test)]
mod tests {
    use super::Solution;

    #[test]
    fn example_1() {
        let n = 4;
        let result = Solution::count_and_say(n);
        assert_eq!(result, "1211");
    }

    #[test]
    fn example_2() {
        let n = 1;
        let result = Solution::count_and_say(n);
        assert_eq!(result, "1");
    }

    #[test]
    fn example_3() {
        let n = 30;
        let result = Solution::count_and_say(n);
        let expected = "3113112221131112311332111213122112311311123112111331121113122112132113121113222112311311221112131221123113112221121113311211131122211211131221131211132221121321132132212321121113121112133221123113112221131112212211131221121321131211132221123113112221131112311332211211133112111311222112111312211311123113322112111312211312111322212321121113121112133221121321132132211331121321132213211231132132211211131221232112111312212221121123222112311311222113111231133211121321321122111312211312111322211213211321322123211211131211121332211231131122211311123113321112131221123113111231121123222112111331121113112221121113122113111231133221121113122113121113221112131221123113111231121123222112111312211312111322212321121113121112131112132112311321322112111312212321121113122122211211232221121321132132211331121321231231121113112221121321132132211322132113213221123113112221133112132123222112111312211312112213211231132132211211131221131211322113321132211221121332211231131122211311123113321112131221123113111231121113311211131221121321131211132221123113112211121312211231131122211211133112111311222112111312211312111322211213211321223112111311222112132113213221133122211311221122111312211312111322212321121113121112131112132112311321322112111312212321121113122122211211232221121321132132211331121321231231121113112221121321132132211322132113213221123113112221133112132123222112111312211312112213211231132132211211131221131211322113321132211221121332211213211321322113311213212312311211131122211213211331121321123123211231131122211211131221131112311332211213211321223112111311222112132113213221123123211231132132211231131122211311123113322112111312211312111322111213122112311311123112112322211213211321322113312211223113112221121113122113111231133221121321132132211331222113321112131122211332113221122112133221123113112221131112311332111213122112311311123112111331121113122112132113121113222112311311221112131221123113112221121113311211131122211211131221131211132221121321132132212321121113121112133221123113112221131112311332111213122112311311123112112322211322311311222113111231133211121312211231131112311211232221121113122113121113222123211211131221132211131221121321131211132221123113112211121312211231131122113221122112133221121321132132211331121321231231121113121113122122311311222113111231133221121113122113121113221112131221123113111231121123222112132113213221133112132123123112111312211322311211133112111312211213211311123113223112111321322123122113222122211211232221121113122113121113222123211211131211121311121321123113213221121113122123211211131221121311121312211213211321322112311311222113311213212322211211131221131211221321123113213221121113122113121113222112131112131221121321131211132221121321132132211331121321232221123113112221131112311322311211131122211213211331121321122112133221121113122113121113222123112221221321132132211231131122211331121321232221121113122113121113222123211211131211121332211213111213122112132113121113222112132113213221232112111312111213322112132113213221133112132123123112111311222112132113311213211221121332211231131122211311123113321112131221123113112221132231131122211211131221131112311332211213211321223112111311222112132113212221132221222112112322211211131221131211132221232112111312111213111213211231131112311311221122132113213221133112132123222112311311222113111231132231121113112221121321133112132112211213322112111312211312111322212321121113121112131112132112311321322112111312212321121113122122211211232221121311121312211213211312111322211213211321322123211211131211121332211213211321322113311213211322132112311321322112111312212321121113122122211211232221121321132132211331121321231231121113112221121321133112132112312321123113112221121113122113111231133221121321132122311211131122211213211321222113222122211211232221123113112221131112311332111213122112311311123112111331121113122112132113121113222112311311221112131221123113112221121113311211131122211211131221131211132221121321132132212321121113121112133221123113112221131112311332111213213211221113122113121113222112132113213221232112111312111213322112132113213221133112132123123112111312211322311211133112111312212221121123222112132113213221133112132123222113223113112221131112311332111213122112311311123112112322211211131221131211132221232112111312111213111213211231132132211211131221131211221321123113213221123113112221131112211322212322211231131122211322111312211312111322211213211321322113311213211331121113122122211211132213211231131122212322211331222113112211";
        assert_eq!(result, expected);
    }

}
